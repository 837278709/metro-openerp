<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
		<record id="metro_mrp_bom_form_view" model="ir.ui.view">
            <field name="name">metro_mrp_bom_form_view</field>
            <field name="model">mrp.bom</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="mrp.mrp_bom_form_view"/>
            <field name="arch" type="xml">
	            <data>     
	            	<!-- remove the groups attribute, make the name fields visible to all users  -->
	                <field name="name" position="replace">
	                </field>
	                <field name="code" position="replace">
	                </field>
	                
	            	<!-- make the 'Reference' and 'Name' as the title -->
	            	<xpath expr="//group" position="before">	    	
	                    <div class="oe_title">
	                        <h1>
	                        	<label for="name" class="oe_edit_only" string="BOM"/>
	                            <field name="code" class="oe_inline"/>
	                            <label string=" - "/>
	                            <field name="name" class="oe_inline"/>
	                        </h1>
	                    </div>
	                    <div class="oe_right oe_button_box" name="buttons">
	                        <button name="attachment_tree_view" string="Documents" type="object"/>
	                        <button name="%(mrp.action2)d" string="Bill of Materials Structure" type="action"/>
	                    </div>
	            	</xpath>
                    	       
	                <!-- the common BOM flag -->
	                <field name="type" position="after">
	                	<field name="is_common" attrs="{'invisible':[('bom_id','!=',False)]}" onchange='onchange_is_common(is_common,bom_id)'/>
	                	<field name="common_bom_id" attrs="{'invisible':[('bom_id','=',False)]}" readonly="1"/>
	                </field>
	                <!-- add name to the components list -->
	                <xpath expr="//page/field/tree/field[@name='product_id']" position="before">
                    	<field name="sequence" widget="handle"/>
                    	<field name="code"/>
	                	<field name="name"/>
	                	<field name="common_bom_id"/>
	                </xpath>
	                <notebook position="inside">
                        <page string="Clone BOMs">
                            <field name="clone_bom_ids" widget="one2many_list">
                                <tree string="Clone BOMs" create='false' delete='false'>
	                				<field name="common_bom_id"/>
			                    	<field name="code"/>
				                	<field name="name"/>
                                    <field name="product_id" context="{'default_supply_method':'produce'}" on_change="onchange_product_id(product_id, name)"/>
                                    <field name="product_qty"/>
                                    <field name="product_uom" on_change="onchange_uom(product_id, product_uom)" groups="product.group_uom"/>
                                    <field name="name" invisible="1"/>
                                    <field name="date_start"/>
                                    <field name="date_stop"/>
                                </tree>
                            </field>
                        </page>
                        <page string='Routing Matrix'>
                        	<field name='bom_routing_ids' widget='one2many_list' 
                        		context="{'default_bom_id':id,'default_routing_id':routing_id, 'force_routing_id':True}">
                        		<tree string='BOM Routing Matrix' editable='bottom'>
                        			<field name='bom_id' invisible='1'/>
                        			<field name='routing_id' invisible='1'/>        			
                        			<field name='routing_workcenter_id' domain="[('routing_id','=',routing_id)]"/>
                        			<field name='bom_comp_id' domain="[('bom_lines','!=',False),('bom_id','child_of',bom_id)]"/>
                        		</tree>
                        	</field>
                        </page>	                
	                </notebook>
	                <!-- make the fields to readonly  for the BOM having common BOM
	                except product_qty,name,code,sequence,date_start,date_stop -->
	                <field name="product_id" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="routing_id" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="type" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="bom_lines" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="position" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="bom_id" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="sequence" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="active" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="product_rounding" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	                <field name="product_efficiency" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field>
	            </data>
        	</field>
       	</record>
		<record id="metro_mrp_bom_pe_form_view" model="ir.ui.view">
            <field name="name">metro_mrp_bom_pe_form_view</field>
            <field name="model">mrp.bom</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="product_extended.mrp_bom_form_view_product_extended"/>
            <field name="arch" type="xml">
	            <data>
	                <field name="standard_price" position="attributes">
	                	<attribute name="attrs">{'readonly':[('common_bom_id','!=',False)]}</attribute>
	                </field> 
	            </data>
	        </field>
	    </record>      	
       	
	<!-- Add BOM Name to display -->       	 
		<record id="metro_mrp_bom_tree_view" model="ir.ui.view">
            <field name="name">metro_mrp_bom_tree_view</field>
            <field name="model">mrp.bom</field>
            <field name="inherit_id" ref="mrp.mrp_bom_tree_view"/>
            <field name="arch" type="xml">
	            <data>
	                <field name="code" position="replace">
	                </field>
	                <field name="name" position="attributes">
	                	<attribute name="invisible">0</attribute>
	                </field>
	                <field name="name" position="before">
	                	<field name="is_common"/>
	                	<field name="code"/>
	                </field>
	            </data>
        	</field>
       	</record>
	<!-- Add BOM Name to display -->       	 
		<record id="metro_mrp_bom_component_tree_view" model="ir.ui.view">
            <field name="name">metro_mrp_bom_component_tree_view</field>
            <field name="model">mrp.bom</field>
            <field name="inherit_id" ref="mrp.mrp_bom_component_tree_view"/>
            <field name="arch" type="xml">
	            <data>
	                <field name="code" position="replace">
	                </field>
	                <field name="name" position="attributes">
	                	<attribute name="groups"/>
	                </field>
	                <field name="name" position="before">
	                	<field name="is_common"/>
	                	<field name="common_bom_id"/>
	                	<field name="code"/>
	                </field>
	            </data>
        	</field>
       	</record> 
	<!-- Manufacture Production Order -->      
		<record id="metro_mrp_production_tree_view" model="ir.ui.view">
            <field name="name">metro_mrp_production_tree_view</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_tree_view"/>
            <field name="arch" type="xml">
                  <field name="product_id" position="after">
                   		<field name="bom_id"/>
                  </field>
			</field>
        </record>
         	      	
		<record id="metro_mrp_production_form_view" model="ir.ui.view">
            <field name="name">metro_mrp_production_form_view</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
            <field name="arch" type="xml">
	            <data>
	            	<!-- Add the date related fields-->
	                <field name="date_start" position="replace">
	                </field>
	                <field name="date_finished" position="replace">
	                </field>
                    <field name="date_planned" position="after">
                    	<field name="date_start"/>
                    	<field name="date_finished"/>
                    	<field name="hour_total"/>
                    	<field name="cycle_total"/>
                    </field>
                    <!-- adjust the location field position -->
	                <xpath expr="//group[@groups='stock.group_locations']" position="replace">
	                </xpath>
                    <field name="origin" position="after">
                    	<field name="mfg_ids" domain="[('state','in',('confirmed','engineer'))]" widget="many2many_tags"/>
                        <field name="location_src_id" domain="[('usage','=','internal')]" on_change="location_id_change(location_src_id,location_dest_id)"/>
                        <field name="location_dest_id" domain="[('usage','=','internal')]"/>
                    </field>
                    <!-- Only the products with 'Manufacture' supply method can be produce-->
                    <field name="product_id" position="replace">
                    	<field name="product_id" on_change="product_id_change(product_id)" 
                    	domain="[('bom_ids','!=',False),('bom_ids.bom_id','=',False),('supply_method','=','produce'),('type','=','product')]" class="oe_inline"/>                    	
                    </field>
	            </data>
        	</field>
       	</record>
        <!-- Fix the BOM structure tree displaying issue, add the view_type&view_mode -->                           
        <record id="mrp.action2" model="ir.actions.act_window">
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.bom</field>
            <field name="view_type">tree</field>
            <field name="view_mode">tree</field>
        </record>
                                                   	       	
	<!-- Add 'material' field to product -->                                 
		<record id="bom_product_mfg_view" model="ir.ui.view">
            <field name="name">bom_product_mfg_view</field>
            <field name="model">product.product</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="product_manufacturer.view_product_form_expiry"/>
            <field name="arch" type="xml">
	            <data>
	                <field name="manufacturer" position="before">
	                	<field name="material"/>
	                </field>
	            </data>
        	</field>
       	</record>
	</data>	  
</openerp>
